import pandas as pd
import numpy as np
import matplotlib.pyplot as plt 

# import data
movies = pd.read_table("/Users/bellehuang/Downloads/STA4101/final_project/movies.txt")

# glimpse data
print(movies.head(10))

numeric_cols = ["Gross", "Tickets.Sold", "Year", "Rank"]
for c in numeric_cols:
    if c in movies.columns:
        movies[c] = pd.to_numeric(movies[c], errors="coerce")

# parse dates
if "Release.Date" in movies.columns:
    movies["Release.Date"] = pd.to_datetime(movies["Release.Date"], errors="coerce")


# Top 10 movies by Gross
top10 = movies.nlargest(10, "Gross")[["Movie", "Gross"]].iloc[::-1]  # reverse for horizontal plot order
plt.figure()
plt.barh(top10["Movie"], top10["Gross"])
plt.title("Top 10 Movies by Domestic Gross")
plt.xlabel("Gross (USD)")
plt.tight_layout()
plt.show()

# Top 10 movies by Number of Tickets Sold
top10 = movies.nlargest(10, "Tickets.Sold")[["Movie", "Tickets.Sold"]].iloc[::-1]  # reverse for horizontal plot order
plt.figure()
plt.barh(top10["Movie"], top10["Tickets.Sold"])
plt.title("Top 10 Movies by Number of Tickets Sold")
plt.xlabel("Number of Tickets Sold")
plt.tight_layout()
plt.show()

# Total Gross by Genre
if "Genre" in movies.columns:
    gross_by_genre = movies.groupby("Genre", as_index=False)["Gross"].sum().sort_values("Gross", ascending=False)
    plt.figure()
    plt.bar(gross_by_genre["Genre"], gross_by_genre["Gross"])
    plt.title("Total Domestic Gross by Genre")
    plt.ylabel("Gross (USD)")
    plt.xticks(rotation=45, ha="right")
    plt.tight_layout()
    plt.show()

# Tickets Sold vs Gross
plt.figure()
plt.scatter(movies["Tickets.Sold"], movies["Gross"])
plt.title("Tickets Sold vs Gross")
plt.xlabel("Tickets Sold")
plt.ylabel("Gross (USD)")
plt.tight_layout()
plt.show()

# Distribution of Gross
plt.figure()
plt.hist(movies["Gross"].dropna(), bins=30)
plt.title("Distribution of Domestic Gross")
plt.xlabel("Gross (USD)")
plt.ylabel("Count of Movies")
plt.tight_layout()
plt.show()

# Number of movies in each genre
counts = (
    movies["Genre"]
    .fillna("Unknown")
    .value_counts()
    .sort_values(ascending=False))

plt.figure()
plt.bar(counts.index, counts.values)
plt.title("Number of Movies by Genre")
plt.ylabel("Count")
plt.xticks(rotation=45, ha="right")
plt.tight_layout()
plt.show()


# Number of movies in each genre
counts = (
    movies["MPAA"]
    .fillna("Unknown")
    .value_counts()
    .sort_values(ascending=False))

plt.figure()
plt.bar(counts.index, counts.values)
plt.title("Number of Movies by Age Restriction")
plt.ylabel("Count")
plt.xticks(rotation=45, ha="right")
plt.tight_layout()
plt.show()

# Top 10 Distributors
counts = (
    movies["Distributor"]
    .fillna("Unknown")
    .value_counts()
    .head(10)
)

# Plot (horizontal for readability)
plt.figure()
counts.sort_values(ascending=True).plot(kind="barh")
plt.title("Top 10 Distributors by Number of Movies")
plt.xlabel("Number of Movies")
plt.ylabel("Distributor")
plt.tight_layout()
plt.show()

## Numerical Summaries
print(max(movies["Gross"]), min(movies["Gross"]), np.mean(movies["Gross"]))
print(max(movies["Tickets.Sold"]), min(movies["Tickets.Sold"]), np.mean(movies["Tickets.Sold"]))

